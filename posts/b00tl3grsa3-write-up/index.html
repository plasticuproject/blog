<!DOCTYPE html>
<html lang="en-us">
	<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="plasticuproject">
<meta name="description" content="Self Promoting Blog">
<meta name="generator" content="Hugo 0.70.0" />
<title>picoCTF 2019 b00tl3gRSA3 Write-Up</title>
<link rel="shortcut icon" href="https://plasticuproject.com/images/favicon.ico">
<link rel="stylesheet" href="https://plasticuproject.com/css/style.css">
<link rel="stylesheet" href="https://plasticuproject.com/css/highlight.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">

    
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>

    
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"
        onload="renderMathInElement(document.body);"></script>



<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">



<link href="https://plasticuproject.com/index.xml" rel="alternate" type="application/rss+xml" title="plasticuproject&#39;s blog" />


<meta property="og:title" content="picoCTF 2019 b00tl3gRSA3 Write-Up" />
<meta property="og:description" content="b00tl3gRSA3 is a picoCTF 2019 cryptography challenge where we have to decrypt a message given just the RSA Public Key constituents." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://plasticuproject.com/posts/b00tl3grsa3-write-up/" />
<meta property="article:published_time" content="2020-05-15T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-05-15T00:00:00+00:00" />


<meta itemprop="name" content="picoCTF 2019 b00tl3gRSA3 Write-Up">
<meta itemprop="description" content="b00tl3gRSA3 is a picoCTF 2019 cryptography challenge where we have to decrypt a message given just the RSA Public Key constituents.">
<meta itemprop="datePublished" content="2020-05-15T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2020-05-15T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="1794">



<meta itemprop="keywords" content="picoCTF,Write-Up,Python,Cryptography," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="picoCTF 2019 b00tl3gRSA3 Write-Up"/>
<meta name="twitter:description" content="b00tl3gRSA3 is a picoCTF 2019 cryptography challenge where we have to decrypt a message given just the RSA Public Key constituents."/>


    </head>
<body>
    <nav class="main-nav">
	
		<a href='https://plasticuproject.com'>Home</a>
	

	
 		<a href='/about/'>About</a>
  	

    <a href='https://plasticuproject.com/tags'>Tags</a>

	
		<a href="https://plasticuproject.com/index.xml">RSS</a>
	
</nav>

    <section id="wrapper">
        
        
<article class="post">
    <header>
        <h1>picoCTF 2019 b00tl3gRSA3 Write-Up</h1>
        <h2 class="subtitle">b00tl3gRSA3 is a picoCTF 2019 cryptography challenge where we have to decrypt a message given just the RSA Public Key constituents.</h2>
        <h2 class="headline">
        May 15, 2020
        <br>
          
            
              
              <a href="https://plasticuproject.com/tags/picoctf">picoCTF</a>
            
               | 
              <a href="https://plasticuproject.com/tags/write-up">Write-Up</a>
            
               | 
              <a href="https://plasticuproject.com/tags/python">Python</a>
            
               | 
              <a href="https://plasticuproject.com/tags/cryptography">Cryptography</a>
            
          
        </h2>
    </header>
    <section id="post-body">
        <p><figure><img src="/images/b00tl3gRSA3/picoctf_logo.png#center" alt=""></figure></p>

<hr>

<h2 id="the-challenge">The Challenge</h2>

<p><figure><img src="/images/b00tl3gRSA3/challenge.png#center" alt="Challenge"></figure></p>

<p>Let's connect with netcat like it tells us and see what we are given to work with.</p>

<p><figure><img src="/images/b00tl3gRSA3/values.png#center" alt="Challenge"></figure></p>

<p>It has returned to us numerical values for <span  class="math">\(c\)</span>, <span  class="math">\(n\)</span> and <span  class="math">\(e\)</span>. Experience tells us that this is an <strong>encrypted ciphertext</strong>, <strong>RSA Key Modulus</strong> value, and <strong>RSA Key Exponent</strong> value, respectively. Values <span  class="math">\(n\)</span> and <span  class="math">\(e\)</span> make up the <strong>RSA Public Key</strong> that was used to encrypt a plaintext message <span  class="math">\(m\)</span>, and produce ciphertext <span  class="math">\(c\)</span>. We need to break this encryption by calculating a <strong>RSA Private Key</strong> from these values, then use it to decrypt <span  class="math">\(c\)</span>. Let's first look at how RSA Keys are generated before trying to crack this.</p>

<hr>

<h2 id="rsa-key-generation">RSA Key Generation</h2>

<p>&quot;RSA key generation is fairly simple. It's mostly multiplication and exponentiation. The whole basis of RSA keys is that choosing two numbers, <span  class="math">\(p\)</span> and <span  class="math">\(q\)</span>, and multiplying them together is <em>very easy</em>, while trying to figure out what two numbers multiply together to form <span  class="math">\(n\)</span> is <em>very hard</em>.&quot; <sup id="cite_note-1"><a href="#cite_ref-1">[1]</a></sup></p>

<h3 id="the-math">The Math</h3>

<ul>
<li><span  class="math">\(n = pq\)</span></li>
</ul>

<p>To calculate <span  class="math">\(n\)</span> we need to find two random prime numbers, <span  class="math">\(p\)</span> and <span  class="math">\(q\)</span>, of similar length and multiply them. The longer the numbers the stronger the encryption, but the trade-off is that it will take more time and/or power to encrypt or decrypt messages.</p>

<ul>
<li><span  class="math">\(\lambda(n) = (p - 1)(q - 1)\)</span></li>
</ul>

<p>Compute <span  class="math">\(\lambda(n)\)</span>, where <span  class="math">\(\lambda\)</span> is <a href="https://en.wikipedia.org/wiki/Carmichael%27s_totient_function">Carmichael's totient function</a>. Since <span  class="math">\(n = pq\)</span>, <span  class="math">\(\lambda(n) = lcm(\lambda(p),\lambda(q))\)</span>, and since <span  class="math">\(p\)</span> and <span  class="math">\(q\)</span> are prime, <span  class="math">\(\lambda(p) = \phi(p) = p − 1\)</span> and likewise <span  class="math">\(\lambda(q) = q − 1\)</span>. Hence <span  class="math">\(\lambda(n) = lcm(p − 1, q − 1)\)</span>. <sup id="cite_note-2"><a href="#cite_ref-2">[2]</a></sup></p>

<ul>
<li><span  class="math">\(e = 65537\)</span></li>
</ul>

<p>We next choose an exponent, <span  class="math">\(e\)</span>. This number should be greater than <span  class="math">\(1\)</span>, less than and <a href="https://en.wikipedia.org/wiki/Coprime_integers">coprime</a> with <span  class="math">\(\lambda(n)\)</span>. The value used for this is usually <span  class="math">\(65537\)</span>.</p>

<ul>
<li><span  class="math">\(d \equiv e^{-1} \pmod{\lambda(n)}\)</span></li>
</ul>

<p><span  class="math">\(d\)</span> is the modular <a href="https://en.wikipedia.org/wiki/Multiplicative_inverse">multiplicative inverse</a> of <span  class="math">\(e\)</span> modulus <span  class="math">\( \lambda(n)\)</span>. <span  class="math">\(d\)</span> is the <strong>Private Key Exponent</strong> and should never be shared.</p>

<ul>
<li><span  class="math">\(c \equiv m^e \pmod{n}\)</span></li>
</ul>

<p>This will encrypt your integer converted message <span  class="math">\(m\)</span> into an RSA encrypted ciphertext <span  class="math">\(c\)</span>.</p>

<ul>
<li><span  class="math">\(c^d \equiv (m^e)^d \equiv m \pmod n\)</span></li>
</ul>

<p>This will decrypt the encrypted ciphertext <span  class="math">\(c\)</span> back into it's integer message form <span  class="math">\(m\)</span>.</p>

<p><span  class="math">\(n\)</span> and <span  class="math">\(e\)</span> are used to construct the Public Key, while <span  class="math">\(n\)</span> and <span  class="math">\(d\)</span> are used to create the Private Key.</p>

<h3 id="constructing-values-and-keys-in-python">Constructing Values and Keys in Python</h3>

<p>Calculating our values in Python code will look something like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># modular multiplicative inverse</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">mod_inv</span>(a, n):
    t, r <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, n
    new_t, new_r <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, a
    <span style="color:#66d9ef">while</span> new_r <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>:
        quotient <span style="color:#f92672">=</span> r <span style="color:#f92672">//</span> new_r
        t, new_t <span style="color:#f92672">=</span> new_t, t <span style="color:#f92672">-</span> quotient <span style="color:#f92672">*</span> new_t
        r, new_r <span style="color:#f92672">=</span> new_r, r <span style="color:#f92672">-</span> quotient <span style="color:#f92672">*</span> new_r
    <span style="color:#66d9ef">if</span> r <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>:
        <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">Exception</span>(<span style="color:#e6db74">&#34;a is not invertible&#34;</span>)
    <span style="color:#66d9ef">if</span> t <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>:
        t <span style="color:#f92672">=</span> t <span style="color:#f92672">+</span> n
    <span style="color:#66d9ef">return</span> t

<span style="color:#75715e"># random prime numbers</span>
p <span style="color:#f92672">=</span> <span style="color:#ae81ff">1973</span>
q <span style="color:#f92672">=</span> <span style="color:#ae81ff">1511</span>

<span style="color:#75715e"># calculate public key modulus</span>
n <span style="color:#f92672">=</span> p <span style="color:#f92672">*</span> q

<span style="color:#75715e"># public exponent</span>
e <span style="color:#f92672">=</span> <span style="color:#ae81ff">65537</span>

<span style="color:#75715e"># Carmichaels&#39;s totient of n</span>
lambda_n <span style="color:#f92672">=</span> (p <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> (q <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)

<span style="color:#75715e"># calculate private key exponent</span>
d <span style="color:#f92672">=</span> mod_inv(e, lambda_n)</code></pre></div>
<p>We can also use Python libraries to construct Public and Private Keys. Here we will use the <a href="https://pypi.org/project/pycrypto/">pycrypto</a> library.</p>

<blockquote>
<p><strong>Note</strong>: <em>This library can be insecure and is not recommended for production use unless you know exactly what you are doing.</em></p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> Crypto.PublicKey <span style="color:#f92672">import</span> RSA

<span style="color:#75715e"># modular multiplicative inverse</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">mod_inv</span>(a, n):
    t, r <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, n
    new_t, new_r <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, a
    <span style="color:#66d9ef">while</span> new_r <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>:
        quotient <span style="color:#f92672">=</span> r <span style="color:#f92672">//</span> new_r
        t, new_t <span style="color:#f92672">=</span> new_t, t <span style="color:#f92672">-</span> quotient <span style="color:#f92672">*</span> new_t
        r, new_r <span style="color:#f92672">=</span> new_r, r <span style="color:#f92672">-</span> quotient <span style="color:#f92672">*</span> new_r
    <span style="color:#66d9ef">if</span> r <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>:
        <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">Exception</span>(<span style="color:#e6db74">&#34;a is not invertible&#34;</span>)
    <span style="color:#66d9ef">if</span> t <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>:
        t <span style="color:#f92672">=</span> t <span style="color:#f92672">+</span> n
    <span style="color:#66d9ef">return</span> t

<span style="color:#75715e"># random prime numbers</span>
p <span style="color:#f92672">=</span> <span style="color:#ae81ff">1973</span> 
q <span style="color:#f92672">=</span> <span style="color:#ae81ff">1511</span>

<span style="color:#75715e"># calculate public key modulus</span>
n <span style="color:#f92672">=</span> p <span style="color:#f92672">*</span> q

<span style="color:#75715e"># public exponent</span>
e <span style="color:#f92672">=</span> <span style="color:#ae81ff">65537</span>

<span style="color:#75715e"># Carmichaels&#39;s totient of n</span>
lambda_n <span style="color:#f92672">=</span> (p <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> (q <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)

<span style="color:#75715e"># calculate private key exponent</span>
d <span style="color:#f92672">=</span> mod_inv(e, lambda_n)

<span style="color:#75715e"># construct keys</span>
key_params <span style="color:#f92672">=</span> (n, e, d, p, q)
key <span style="color:#f92672">=</span> RSA<span style="color:#f92672">.</span>construct(key_params)

<span style="color:#75715e"># print Private and Public Key</span>
<span style="color:#66d9ef">print</span>(key<span style="color:#f92672">.</span>exportKey()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf-8&#39;</span>) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
<span style="color:#66d9ef">print</span>(key<span style="color:#f92672">.</span>publickey()<span style="color:#f92672">.</span>exportKey()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf-8&#39;</span>) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)</code></pre></div>
<p>This will produce the output:</p>
<pre><code>-----BEGIN RSA PRIVATE KEY-----
MCUCAQACAy19UwIDAQABAgMBmJECAge1AgIF5wIBTQICAZMCAgZK
-----END RSA PRIVATE KEY-----

-----BEGIN PUBLIC KEY-----
MB4wDQYJKoZIhvcNAQEBBQADDQAwCgIDLX1TAgMBAAE=
-----END PUBLIC KEY-----</code></pre>
<p>We can now write these to files for storage, distribution, and use to encrypt or decrypt messages.</p>

<hr>

<h2 id="back-to-the-challenge">Back To The Challenge</h2>

<p>Now that we know how RSA Keys are generated, we can try to crack the Public Key values that we obtained from the server and construct the Private key. The first thing we need to do is try to factor <span  class="math">\(n\)</span> into it's primes <span  class="math">\(p\)</span> and <span  class="math">\(q\)</span>. With strong enough prime values this would be impossible, but since this is a CTF challenge we know there will be a vulnerability somewhere in this scheme. To factor <span  class="math">\(n\)</span>, I will use a web tool called <a href="https://www.alpertron.com.ar/ECM.HTM">Integer Factorization Calculator</a>. Using the factoring tool on this site tells us that <span  class="math">\(n\)</span> can be made from the following multiples:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># factors of n</span>
p1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">8694307819</span>
p2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">8775407717</span>
p3 <span style="color:#f92672">=</span> <span style="color:#ae81ff">9026241761</span>
p4 <span style="color:#f92672">=</span> <span style="color:#ae81ff">9057149533</span>
p5 <span style="color:#f92672">=</span> <span style="color:#ae81ff">9585778841</span>
p6 <span style="color:#f92672">=</span> <span style="color:#ae81ff">9733417549</span>
p7 <span style="color:#f92672">=</span> <span style="color:#ae81ff">9855694997</span>
p8 <span style="color:#f92672">=</span> <span style="color:#ae81ff">9903110561</span>
p9 <span style="color:#f92672">=</span> <span style="color:#ae81ff">9960439201</span>
p10 <span style="color:#f92672">=</span> <span style="color:#ae81ff">10016164247</span>
p11 <span style="color:#f92672">=</span> <span style="color:#ae81ff">10213913951</span>
p12 <span style="color:#f92672">=</span> <span style="color:#ae81ff">10375133233</span>
p13 <span style="color:#f92672">=</span> <span style="color:#ae81ff">10888745003</span>
p14 <span style="color:#f92672">=</span> <span style="color:#ae81ff">10928267249</span>
p15 <span style="color:#f92672">=</span> <span style="color:#ae81ff">11093110097</span>
p16 <span style="color:#f92672">=</span> <span style="color:#ae81ff">11969573459</span>
p17 <span style="color:#f92672">=</span> <span style="color:#ae81ff">12351917503</span>
p18 <span style="color:#f92672">=</span> <span style="color:#ae81ff">12471968101</span>
p19 <span style="color:#f92672">=</span> <span style="color:#ae81ff">13871073973</span>
p20 <span style="color:#f92672">=</span> <span style="color:#ae81ff">14396917097</span>
p21 <span style="color:#f92672">=</span> <span style="color:#ae81ff">14539225093</span>
p22 <span style="color:#f92672">=</span> <span style="color:#ae81ff">14717833373</span>
p23 <span style="color:#f92672">=</span> <span style="color:#ae81ff">14837579117</span>
p24 <span style="color:#f92672">=</span> <span style="color:#ae81ff">15209272151</span>
p25 <span style="color:#f92672">=</span> <span style="color:#ae81ff">15280005421</span>
p26 <span style="color:#f92672">=</span> <span style="color:#ae81ff">15484737221</span>
p27 <span style="color:#f92672">=</span> <span style="color:#ae81ff">15554133887</span>
p28 <span style="color:#f92672">=</span> <span style="color:#ae81ff">16042139507</span>
p29 <span style="color:#f92672">=</span> <span style="color:#ae81ff">16278648473</span>
p30 <span style="color:#f92672">=</span> <span style="color:#ae81ff">16335802403</span>
p31 <span style="color:#f92672">=</span> <span style="color:#ae81ff">16382994611</span>
p32 <span style="color:#f92672">=</span> <span style="color:#ae81ff">16728205063</span>
p33 <span style="color:#f92672">=</span> <span style="color:#ae81ff">16809927443</span>
p34 <span style="color:#f92672">=</span> <span style="color:#ae81ff">16861924201</span></code></pre></div>
<p>That's way more than two numbers! What is going on here? Let's look again at what the challenge description says:</p>

<blockquote>
<p><em>Why use p and q when I can use more?</em></p>
</blockquote>

<p>Now this makes sense. They insecurely built their Keys by using <em>many</em> numbers to compute <span  class="math">\(n\)</span>, and because of this we were able to factor <span  class="math">\(n\)</span> into it's constituents. We now have the information we need to build the Private Key values and decrypt <span  class="math">\(c\)</span>. We can do this in Python, but will have to make some changes to our code. We will first write some test code to assert that all these integers multiplied will equal our <span  class="math">\(n\)</span> value. Then we will place all the values into a list, and create some logic to derive our <span  class="math">\(\lambda(n)\)</span> from the entire list of integers. Then we can calculate <span  class="math">\(d\)</span>, our <strong>Private Key Exponent</strong>. That code will look like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> math <span style="color:#f92672">import</span> gcd

<span style="color:#75715e"># modular multiplicative inverse</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">mod_inv</span>(a, n):
    t, r <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, n
    new_t, new_r <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, a
    <span style="color:#66d9ef">while</span> new_r <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>:
        quotient <span style="color:#f92672">=</span> r <span style="color:#f92672">//</span> new_r
        t, new_t <span style="color:#f92672">=</span> new_t, t <span style="color:#f92672">-</span> quotient <span style="color:#f92672">*</span> new_t
        r, new_r <span style="color:#f92672">=</span> new_r, r <span style="color:#f92672">-</span> quotient <span style="color:#f92672">*</span> new_r
    <span style="color:#66d9ef">if</span> r <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>:
        <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">Exception</span>(<span style="color:#e6db74">&#34;a is not invertible&#34;</span>)
    <span style="color:#66d9ef">if</span> t <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>:
        t <span style="color:#f92672">=</span> t <span style="color:#f92672">+</span> n
    <span style="color:#66d9ef">return</span> t

<span style="color:#75715e"># Carmichael&#39;s totient</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">calc_lambda_n</span>(ps):
    lcm <span style="color:#f92672">=</span> ps[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> ps[<span style="color:#ae81ff">1</span>:]:
        j <span style="color:#f92672">=</span> i <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>
        lcm <span style="color:#f92672">=</span> lcm<span style="color:#f92672">*</span>j<span style="color:#f92672">//</span>gcd(lcm, j)
    <span style="color:#66d9ef">return</span> lcm

<span style="color:#75715e"># test factorization</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_factor</span>(ps, n):
    q <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> ps:
        q <span style="color:#f92672">*=</span> i
    <span style="color:#66d9ef">if</span> q <span style="color:#f92672">==</span> n:
        b <span style="color:#f92672">=</span> True
    <span style="color:#66d9ef">elif</span> q <span style="color:#f92672">!=</span> n:
        b <span style="color:#f92672">=</span> False
    <span style="color:#66d9ef">return</span> b

<span style="color:#75715e"># factors of n</span>
p1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">8694307819</span>
p2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">8775407717</span>
p3 <span style="color:#f92672">=</span> <span style="color:#ae81ff">9026241761</span>
p4 <span style="color:#f92672">=</span> <span style="color:#ae81ff">9057149533</span>
p5 <span style="color:#f92672">=</span> <span style="color:#ae81ff">9585778841</span>
p6 <span style="color:#f92672">=</span> <span style="color:#ae81ff">9733417549</span>
p7 <span style="color:#f92672">=</span> <span style="color:#ae81ff">9855694997</span>
p8 <span style="color:#f92672">=</span> <span style="color:#ae81ff">9903110561</span>
p9 <span style="color:#f92672">=</span> <span style="color:#ae81ff">9960439201</span>
p10 <span style="color:#f92672">=</span> <span style="color:#ae81ff">10016164247</span>
p11 <span style="color:#f92672">=</span> <span style="color:#ae81ff">10213913951</span>
p12 <span style="color:#f92672">=</span> <span style="color:#ae81ff">10375133233</span>
p13 <span style="color:#f92672">=</span> <span style="color:#ae81ff">10888745003</span>
p14 <span style="color:#f92672">=</span> <span style="color:#ae81ff">10928267249</span>
p15 <span style="color:#f92672">=</span> <span style="color:#ae81ff">11093110097</span>
p16 <span style="color:#f92672">=</span> <span style="color:#ae81ff">11969573459</span>
p17 <span style="color:#f92672">=</span> <span style="color:#ae81ff">12351917503</span>
p18 <span style="color:#f92672">=</span> <span style="color:#ae81ff">12471968101</span>
p19 <span style="color:#f92672">=</span> <span style="color:#ae81ff">13871073973</span>
p20 <span style="color:#f92672">=</span> <span style="color:#ae81ff">14396917097</span>
p21 <span style="color:#f92672">=</span> <span style="color:#ae81ff">14539225093</span>
p22 <span style="color:#f92672">=</span> <span style="color:#ae81ff">14717833373</span>
p23 <span style="color:#f92672">=</span> <span style="color:#ae81ff">14837579117</span>
p24 <span style="color:#f92672">=</span> <span style="color:#ae81ff">15209272151</span>
p25 <span style="color:#f92672">=</span> <span style="color:#ae81ff">15280005421</span>
p26 <span style="color:#f92672">=</span> <span style="color:#ae81ff">15484737221</span>
p27 <span style="color:#f92672">=</span> <span style="color:#ae81ff">15554133887</span>
p28 <span style="color:#f92672">=</span> <span style="color:#ae81ff">16042139507</span>
p29 <span style="color:#f92672">=</span> <span style="color:#ae81ff">16278648473</span>
p30 <span style="color:#f92672">=</span> <span style="color:#ae81ff">16335802403</span>
p31 <span style="color:#f92672">=</span> <span style="color:#ae81ff">16382994611</span>
p32 <span style="color:#f92672">=</span> <span style="color:#ae81ff">16728205063</span>
p33 <span style="color:#f92672">=</span> <span style="color:#ae81ff">16809927443</span>
p34 <span style="color:#f92672">=</span> <span style="color:#ae81ff">16861924201</span>

<span style="color:#75715e"># list of factors</span>
ps <span style="color:#f92672">=</span> []
[ps<span style="color:#f92672">.</span>append(globals()[<span style="color:#e6db74">&#39;p&#39;</span> <span style="color:#f92672">+</span> str(i)]) <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">35</span>)]

<span style="color:#75715e"># verify p1*p2*...p34 = n</span>
<span style="color:#66d9ef">assert</span>(test_factor(ps, n))

<span style="color:#75715e"># Carmichaels&#39;s totient of n</span>
lambda_n <span style="color:#f92672">=</span> calc_lambda_n(ps)

<span style="color:#75715e"># calculate private key exponent</span>
d <span style="color:#f92672">=</span> mod_inv(e, lambda_n)</code></pre></div>
<p>Now we can just add our <span  class="math">\(c\)</span>, <span  class="math">\(n\)</span>, and <span  class="math">\(e\)</span> values given, and decrypt <span  class="math">\(c\)</span> by adding the following:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">message <span style="color:#f92672">=</span> pow(c, d, n)
<span style="color:#66d9ef">print</span>(bytes<span style="color:#f92672">.</span>fromhex(hex(message)[<span style="color:#ae81ff">2</span>:])<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf-8&#39;</span>))</code></pre></div>
<p>The final Python script will look as follows:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> math <span style="color:#f92672">import</span> gcd

<span style="color:#75715e"># cipher text and public key values</span>
c <span style="color:#f92672">=</span> <span style="color:#ae81ff">14233215171999431620670742801992653887466654474564774567565482115708994971815998692805257101560625714845217078751863031453530789139353946667912836198369580283828831512520753040759574661583289733067194603349961285220341733595404870252973575776007626137207539918299185290666626201682475925787500697075273517928342450904756899125972158778923306466</span>

n <span style="color:#f92672">=</span> <span style="color:#ae81ff">17190751765871320929594511788715040293755178677970494040999935752481499432324081420804535569049828358872534054083287610758506232432273611461779363808286315449034509728493030687881521253447668499524454596411931335376554928809260061677941571447357490867956927337940685369932675855590823386769800936470170609619423644569934236531433566627693968207</span>

e <span style="color:#f92672">=</span> <span style="color:#ae81ff">65537</span>

<span style="color:#75715e"># modular multiplicative inverse</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">mod_inv</span>(a, n):
    t, r <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, n
    new_t, new_r <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, a
    <span style="color:#66d9ef">while</span> new_r <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>:
        quotient <span style="color:#f92672">=</span> r <span style="color:#f92672">//</span> new_r
        t, new_t <span style="color:#f92672">=</span> new_t, t <span style="color:#f92672">-</span> quotient <span style="color:#f92672">*</span> new_t
        r, new_r <span style="color:#f92672">=</span> new_r, r <span style="color:#f92672">-</span> quotient <span style="color:#f92672">*</span> new_r
    <span style="color:#66d9ef">if</span> r <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>:
        <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">Exception</span>(<span style="color:#e6db74">&#34;a is not invertible&#34;</span>)
    <span style="color:#66d9ef">if</span> t <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>:
        t <span style="color:#f92672">=</span> t <span style="color:#f92672">+</span> n
    <span style="color:#66d9ef">return</span> t

<span style="color:#75715e"># Carmichael&#39;s totient</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">calc_lambda_n</span>(ps):
    lcm <span style="color:#f92672">=</span> ps[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> ps[<span style="color:#ae81ff">1</span>:]:
        j <span style="color:#f92672">=</span> i <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>
        lcm <span style="color:#f92672">=</span> lcm<span style="color:#f92672">*</span>j<span style="color:#f92672">//</span>gcd(lcm, j)
    <span style="color:#66d9ef">return</span> lcm

<span style="color:#75715e"># test factorization</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_factor</span>(ps, n):
    q <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> ps:
        q <span style="color:#f92672">*=</span> i
    <span style="color:#66d9ef">if</span> q <span style="color:#f92672">==</span> n:
        b <span style="color:#f92672">=</span> True
    <span style="color:#66d9ef">elif</span> q <span style="color:#f92672">!=</span> n:
        b <span style="color:#f92672">=</span> False
    <span style="color:#66d9ef">return</span> b

<span style="color:#75715e"># factors of n</span>
p1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">8694307819</span>
p2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">8775407717</span>
p3 <span style="color:#f92672">=</span> <span style="color:#ae81ff">9026241761</span>
p4 <span style="color:#f92672">=</span> <span style="color:#ae81ff">9057149533</span>
p5 <span style="color:#f92672">=</span> <span style="color:#ae81ff">9585778841</span>
p6 <span style="color:#f92672">=</span> <span style="color:#ae81ff">9733417549</span>
p7 <span style="color:#f92672">=</span> <span style="color:#ae81ff">9855694997</span>
p8 <span style="color:#f92672">=</span> <span style="color:#ae81ff">9903110561</span>
p9 <span style="color:#f92672">=</span> <span style="color:#ae81ff">9960439201</span>
p10 <span style="color:#f92672">=</span> <span style="color:#ae81ff">10016164247</span>
p11 <span style="color:#f92672">=</span> <span style="color:#ae81ff">10213913951</span>
p12 <span style="color:#f92672">=</span> <span style="color:#ae81ff">10375133233</span>
p13 <span style="color:#f92672">=</span> <span style="color:#ae81ff">10888745003</span>
p14 <span style="color:#f92672">=</span> <span style="color:#ae81ff">10928267249</span>
p15 <span style="color:#f92672">=</span> <span style="color:#ae81ff">11093110097</span>
p16 <span style="color:#f92672">=</span> <span style="color:#ae81ff">11969573459</span>
p17 <span style="color:#f92672">=</span> <span style="color:#ae81ff">12351917503</span>
p18 <span style="color:#f92672">=</span> <span style="color:#ae81ff">12471968101</span>
p19 <span style="color:#f92672">=</span> <span style="color:#ae81ff">13871073973</span>
p20 <span style="color:#f92672">=</span> <span style="color:#ae81ff">14396917097</span>
p21 <span style="color:#f92672">=</span> <span style="color:#ae81ff">14539225093</span>
p22 <span style="color:#f92672">=</span> <span style="color:#ae81ff">14717833373</span>
p23 <span style="color:#f92672">=</span> <span style="color:#ae81ff">14837579117</span>
p24 <span style="color:#f92672">=</span> <span style="color:#ae81ff">15209272151</span>
p25 <span style="color:#f92672">=</span> <span style="color:#ae81ff">15280005421</span>
p26 <span style="color:#f92672">=</span> <span style="color:#ae81ff">15484737221</span>
p27 <span style="color:#f92672">=</span> <span style="color:#ae81ff">15554133887</span>
p28 <span style="color:#f92672">=</span> <span style="color:#ae81ff">16042139507</span>
p29 <span style="color:#f92672">=</span> <span style="color:#ae81ff">16278648473</span>
p30 <span style="color:#f92672">=</span> <span style="color:#ae81ff">16335802403</span>
p31 <span style="color:#f92672">=</span> <span style="color:#ae81ff">16382994611</span>
p32 <span style="color:#f92672">=</span> <span style="color:#ae81ff">16728205063</span>
p33 <span style="color:#f92672">=</span> <span style="color:#ae81ff">16809927443</span>
p34 <span style="color:#f92672">=</span> <span style="color:#ae81ff">16861924201</span>

<span style="color:#75715e"># list of factors</span>
ps <span style="color:#f92672">=</span> []
[ps<span style="color:#f92672">.</span>append(globals()[<span style="color:#e6db74">&#39;p&#39;</span> <span style="color:#f92672">+</span> str(i)]) <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">35</span>)]

<span style="color:#75715e"># verify p1*p2*...p34 = n</span>
<span style="color:#66d9ef">assert</span>(test_factor(ps, n))

<span style="color:#75715e"># Carmichaels&#39;s totient of n</span>
lambda_n <span style="color:#f92672">=</span> calc_lambda_n(ps)

<span style="color:#75715e"># calculate private key exponent</span>
d <span style="color:#f92672">=</span> mod_inv(e, lambda_n)

<span style="color:#75715e"># decrypt our ciphertext</span>
message <span style="color:#f92672">=</span> pow(c, d, n)

<span style="color:#75715e"># print utf-8 encoded results</span>
<span style="color:#66d9ef">print</span>(bytes<span style="color:#f92672">.</span>fromhex(hex(message)[<span style="color:#ae81ff">2</span>:])<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf-8&#39;</span>))</code></pre></div>
<p>And this will print out the resulting decrypted message:</p>
<pre><code>picoCTF{too_many_fact0rs_0744041}</code></pre>
<p>We enter the flag and are notified that our solution is correct.
<figure><img src="/images/b00tl3gRSA3/solved.png#center" alt="solved"></figure></p>

<p>This was a fun challenge demonstrating how to use a basic RSA encryption method for un-padded messages. This is not a very real world example, as it is unlikely you will ever see <span  class="math">\(n\)</span> computed with more than two values, and real messages are rarely un-padded, but this was a great way to get your feet wet with basic principles of RSA Encryption.</p>

<hr>

<h4 id="references">References:</h4>

<ol>
<li><sup id="cite_ref-1"><a href="#cite_note-1">^</a></sup> Bulischeck, N. <a href="https://nbulischeck.io/posts/introduction-to-rsa/">&quot;An Introduction to RSA&quot;</a></li>
<li><sup id="cite_ref-2"><a href="#cite_note-2">^</a></sup> Wikipedia. <a href="https://en.wikipedia.org/wiki/RSA_(cryptosystem)#Key_generation">&quot;RSA (cryptosystem)&quot;</a></li>
</ol>

<hr>

    </section>
</article>

<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "plasticuproject-github-io-blog" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



        
            <footer id="footer">
    
        <div id="social">

	
	
    <a class="symbol" href="https://pypi.org/user/plasticuproject">
        <i class="fa fa-code"></i>
    </a>
    
    <a class="symbol" href="https://www.hackthebox.com/profile/32882">
        <i class="fa fa-cube"></i>
    </a>
    
    <a class="symbol" href="mailto:plastic@plasticuproject.com">
        <i class="fa fa-envelope"></i>
    </a>
    
    <a class="symbol" href="https://www.github.com/plasticuproject">
        <i class="fa fa-github"></i>
    </a>
    
    <a class="symbol" href="https://cryptohack.org/user/snuggles">
        <i class="fa fa-key"></i>
    </a>
    


</div>

    
    <p class="small">
    
        © Copyright 2021 plasticuproject
    
    </p>
</footer>

        
    </section>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://plasticuproject.com/js/main.js"></script>
<script src="https://plasticuproject.com/js/highlight.js"></script>
<script>hljs.initHighlightingOnLoad();</script>




<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-166142607-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


</body>
</html>
